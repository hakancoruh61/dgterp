<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doğan Güneş ERP - Dashboard</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        :root {
            --sidebar-bg: #1a252f;
            --header-bg: #ffffff;
            --accent: #f39c12;
            --text-main: #2c3e50;
            --bg-body: #f4f7f6;
            --success: #27ae60;
            --info: #3498db;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-body);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar { width: 260px; background: var(--sidebar-bg); color: white; display: flex; flex-direction: column; z-index: 100; }
        .sidebar-header { padding: 30px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-header h3 { margin: 0; color: var(--accent); letter-spacing: 1px; font-size: 18px; }
        .menu-list { list-style: none; padding: 20px 0; margin: 0; }
        .menu-item { padding: 15px 25px; display: flex; align-items: center; gap: 15px; cursor: pointer; transition: 0.2s; color: rgba(255,255,255,0.7); }
        .menu-item:hover, .menu-item.active { background: rgba(255,255,255,0.05); color: var(--accent); }

        /* Main Content */
        .main-content { flex: 1; display: flex; flex-direction: column; height: 100vh; }
        .header { height: 70px; background: var(--header-bg); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 90; }
        .exchange-rates { display: flex; gap: 25px; font-size: 14px; font-weight: 600; }
        .rate-box { display: flex; align-items: center; gap: 8px; color: var(--text-main); padding: 5px 12px; background: #f8f9fa; border-radius: 6px; }
        
        /* Dashboard Stats */
        .page-body { padding: 30px; overflow-y: auto; flex: 1; }
        .welcome-card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .stat-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 25px; }
        .stat-card { padding: 25px; border-radius: 10px; border-left: 6px solid; transition: 0.3s; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        .stat-siparis { border-left-color: var(--accent); }
        .stat-boyahane { border-left-color: var(--info); }
        .stat-tamamlanan { border-left-color: var(--success); }
        
        .stat-card h3 { margin: 10px 0 0 0; font-size: 28px; color: var(--text-main); }
        .stat-card small { font-weight: 700; color: #888; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; }

        #content-frame { flex: 1; border: none; width: 100%; height: 100%; display: none; background: var(--bg-body); }
        .user-info { display: flex; align-items: center; gap: 10px; color: var(--text-main); }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">
            <h3>DOĞAN GÜNEŞ</h3>
            <small style="opacity: 0.5;">TEKSTİL ERP v1.0</small>
        </div>
        <ul class="menu-list">
            <li class="menu-item active" id="menu-panel" onclick="showDashboard()">
                <span class="material-icons-round">dashboard</span> Panel
            </li>
            <li class="menu-item" id="menu-siparisler" onclick="loadPage('siparisler.html', 'menu-siparisler')">
                <span class="material-icons-round">shopping_cart</span> Siparişler
            </li>
            <li class="menu-item" id="menu-boyahane" onclick="loadPage('boyahane.html', 'menu-boyahane')">
                <span class="material-icons-round">opacity</span> Boyahane
            </li>
            <li class="menu-item" id="menu-maliyet" onclick="loadPage('maliyet.html', 'menu-maliyet')">
                <span class="material-icons-round">payments</span> Kumaş Maliyeti
            </li>
            <li class="menu-item" id="menu-stok" onclick="loadPage('kumasstok.html', 'menu-stok')">
                <span class="material-icons-round">inventory_2</span> Kumaş Stok
            </li>
        </ul>
    </div>

    <div class="main-content">
        <header class="header">
            <div class="exchange-rates">
                <div class="rate-box"><strong>USD:</strong> <span id="usd-rate" style="color:var(--success)">...</span></div>
                <div class="rate-box"><strong>EUR:</strong> <span id="eur-rate" style="color:var(--success)">...</span></div>
            </div>
            <div class="user-info">
                <span class="material-icons-round">account_circle</span>
                <strong>dgterp</strong>
                <button onclick="location.href='index.html'" style="margin-left:15px; border:none; background:none; cursor:pointer; color:#e74c3c; font-weight:bold;">Çıkış</button>
            </div>
        </header>

        <div id="dashboard-view" class="page-body">
            <div class="welcome-card">
                <h2>Sistem Özeti</h2>
                <div class="stat-container">
                    <div class="stat-card stat-siparis">
                        <small>Toplam Aktif Sipariş</small>
                        <h3 id="total-siparis-kg">0 kg</h3>
                    </div>
                    <div class="stat-card stat-boyahane">
                        <small>Boyahane (İşlemde)</small>
                        <h3 id="total-boyahane-kg">0 kg</h3>
                    </div>
                    <div class="stat-card stat-tamamlanan">
                        <small>Tamamlanan Üretim</small>
                        <h3 id="total-tamamlanan-kg" style="color:var(--success)">0 kg</h3>
                    </div>
                </div>
            </div>
        </div>

        <iframe id="content-frame" src="about:blank"></iframe>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDO8t-EAitn7S8sMDT8dussYYOIzoWaRzc",
            authDomain: "dogan-gunes.firebaseapp.com",
            databaseURL: "https://dogan-gunes-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "dogan-gunes",
            appId: "1:713688836860:web:87bcc679b7fe4bd5920579"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        onValue(ref(db, 'siparisler'), (snapshot) => {
            let totalSiparis = 0, totalBoyahane = 0, totalTamamlanan = 0;
            snapshot.forEach((child) => {
                const siparis = child.val();
                totalSiparis += Number(siparis.toplam_kg || siparis.miktar || 0);
                if (siparis.renkler) {
                    Object.values(siparis.renkler).forEach(renk => {
                        const kg = Number(renk.kg || 0);
                        if (renk.durum === "Boyada") totalBoyahane += kg;
                        else if (renk.durum === "Tamamlandı") totalTamamlanan += kg;
                    });
                }
            });
            document.getElementById('total-siparis-kg').innerText = totalSiparis.toLocaleString('tr-TR') + " kg";
            document.getElementById('total-boyahane-kg').innerText = totalBoyahane.toLocaleString('tr-TR') + " kg";
            document.getElementById('total-tamamlanan-kg').innerText = totalTamamlanan.toLocaleString('tr-TR') + " kg";
        });

        window.loadPage = function(url, menuId) {
            document.getElementById('dashboard-view').style.display = 'none';
            const frame = document.getElementById('content-frame');
            frame.style.display = 'block';
            frame.src = url;
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            if(menuId) document.getElementById(menuId).classList.add('active');
        }

        window.showDashboard = function() {
            document.getElementById('content-frame').style.display = 'none';
            document.getElementById('dashboard-view').style.display = 'block';
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            document.getElementById('menu-panel').classList.add('active');
        }

        async function fetchRates() {
            try {
                const res = await fetch('https://open.er-api.com/v6/latest/USD');
                const data = await res.json();
                document.getElementById('usd-rate').innerText = data.rates.TRY.toFixed(4) + " ₺";
                document.getElementById('eur-rate').innerText = (data.rates.TRY / data.rates.EUR).toFixed(4) + " ₺";
            } catch (e) {}
        }
        fetchRates();
        setInterval(fetchRates, 300000);
    </script>
</body>
</html>